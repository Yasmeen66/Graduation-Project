<!-- home.html -->
{% extends 'base.html' %}
{% block content %}
<h1>Meeting Navigator</h1>

<button id="record-button">Start Recording</button>

<h2>All Members:</h2>
<ul>
    {% for member in all_members %}
        <li>{{ member.Name }} - {{ member.Email }}</li>
    {% endfor %}
</ul>

<h2>Recorded Entries:</h2>
<ul>
    {% for record in all_records %}
        <li>{{ record.content }}</li>
    {% empty %}
        <li>No recorded entries yet.</li>
    {% endfor %}
</ul>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        if (Notification.permission !== "granted") {
            Notification.requestPermission();
        }
    });

    function showAlert(message) {
        alert(message);
        if (Notification.permission === "granted") {
            new Notification(message);
        } else if (Notification.permission !== "denied") {
            Notification.requestPermission().then(permission => {
                if (permission === "granted") {
                    new Notification(message);
                }
            });
        }
    }

    document.getElementById('record-button').onclick = function() {
        fetch('/record', {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById('record-button').innerText = data.Status;
            showAlert(data.Status);
        })
        .catch(error => console.error('Error:', error));
    };
</script>
{% endblock %}
